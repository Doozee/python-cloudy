# config file for example.com

upstream example.com {
    server 127.0.0.1:port_num;
}

server {
    listen 80;
    server_name example.com;

    # Don't proxy static files such as robots.txt and favicon.ico.
    # location ~ ^/(favicon.ico|robots.txt|crossdomain.xml)$ {
    #     alias /srv/www/example.com/pri/venv/site/static $1;
    # }

    # Serve media directly out of Nginx for performance
    # location /media {
    #     alias /srv/www/example.com/pub;
    # }

    # Proxy everything else to the backend
    location / {
        proxy_pass http://example.com;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        add_header X-Handled-By $upstream_addr;

        ## System Maintenance (Service Unavailable) 
        if (-f /srv/www/example.com/pri/offline.html ) {
            return 503;
        }
    }

    # error 503 redirect to offline.html page
    error_page 503 @maintenance;
    location @maintenance {
    root /srv/www/example.com/pri/;
        rewrite ^(.*)$ /offline.html break;
    }
}


